<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}Portafolio{% endblock %}</title>
    <meta name="description" content="{% block meta_description %}Portafolio y proyectos{% endblock %}">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- Custom CSS -->
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/portfolio.css' %}">

    <!-- Google Tag Manager / GA4 instrumentation -->
    <script>
      // Always define dataLayer
      window.dataLayer = window.dataLayer || [];
      // Push page_view with UTM params so GTM/GA4 los capture
      (function() {
        try {
          var href = window.location.href;
          var url = new URL(href);
          function q(key) { return url.searchParams.get(key) || ''; }
          var payload = {
            event: 'page_view',
            page_location: href,
            page_title: document.title,
            page_referrer: document.referrer || '',
            utm_source: q('utm_source'),
            utm_medium: q('utm_medium'),
            utm_campaign: q('utm_campaign'),
            utm_term: q('utm_term'),
            utm_content: q('utm_content')
          };
          window.dataLayer.push(payload);
        } catch (e) {
          window.dataLayer.push({ event: 'page_view' });
        }
      })();
    </script>
    {% if GTM_CONTAINER_ID %}
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','{{ GTM_CONTAINER_ID }}');</script>
    {% elif GA_MEASUREMENT_ID %}
    <!-- GA4 fallback (sin GTM) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ GA_MEASUREMENT_ID }}"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', '{{ GA_MEASUREMENT_ID }}');
      // Mapear pushes de dataLayer a gtag en fallback
      (function() {
        var origPush = window.dataLayer.push;
        window.dataLayer.push = function(){
          var args = Array.prototype.slice.call(arguments);
          try {
            var e = args[0] || {};
            if (window.gtag && e.event) {
              var params = {};
              for (var k in e) { if (k !== 'event') params[k] = e[k]; }
              window.gtag('event', e.event, params);
            }
          } catch (err) {}
          return origPush.apply(window.dataLayer, args);
        }
      })();
    </script>
    {% endif %}
    <!-- End GTM/GA4 -->

    {% block head_extra %}{% endblock %}
  </head>
  <body class="bg-main">
    <!-- Google Tag Manager (noscript) -->
    {% if GTM_CONTAINER_ID %}
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id={{ GTM_CONTAINER_ID }}"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    {% endif %}
    <!-- End Google Tag Manager (noscript) -->

    <!-- Header con Navbar -->
    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
            <div class="container">
                <a class="navbar-brand fw-bold text-primary fs-3" href="/">William Peña</a>
                
                <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link text-main fw-medium" href="/">Inicio</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-main fw-medium" href="/open/">Gadgets & Setups</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-main fw-medium" href="/fyq/">FAQ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-main fw-medium" href="/contactame/">Contacto</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main>
      {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="py-4 bg-white">
        <div class="container">
            <div class="row align-items-center">
                <!-- Derechos reservados -->
                <div class="col-12 col-md-6 text-center text-md-start order-2 order-md-1">
                    <p class="text-main mb-0" aria-label="Copyright">
                    &copy; 2025 William Andrés Peña Vargas. Todos los derechos reservados.
                    </p>
                </div>
                
                <!-- Navegación secundaria -->
                <div class="col-12 col-md-6 text-center text-md-end order-1 order-md-2 mb-4 mb-md-0">
                    <nav aria-label="Enlaces secundarios del pie de página">
                        <ul class="list-inline mb-0">
                            <li class="list-inline-item">
                                <a href="/" class="text-main text-decoration-none small">Inicio</a>
                            </li>
                            <li class="list-inline-item">
                                <a href="/open/" class="text-main text-decoration-none small">Gadgets & Setups</a>
                            </li>
                            <li class="list-inline-item">
                                <a href="/fyq/" class="text-main text-decoration-none small">FAQ</a>
                            </li>
                            <li class="list-inline-item">
                                <a href="/contactame/" class="text-main text-decoration-none small">Contacto</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </footer>

    <div id="toast" class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100;">
        <div class="toast hide" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto">Notificación</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                <!-- Contenido del toast -->
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    
    <!-- Custom JS -->
    {% load static %}
    <script src="{% static 'js/portfolio.js' %}"></script>

    {% block scripts %}{% endblock %}
  </body>
</html>
